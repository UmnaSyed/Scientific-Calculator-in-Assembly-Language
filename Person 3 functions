SCIENTIFIC CALCULATOR PROJECT
PERSON 3 FUNCTIONS
1.	Factorial 
2.	Cube 
3.	Percentage
4.	nCr
5.	Trigonometric functions â€“ sin, cos, tan


INCLUDE Irvine32.inc

.data
mainMenu BYTE "============================",0dh,0ah,
               "      MAIN MENU",0dh,0ah,
               "============================",0dh,0ah,
               "1. Factorial",0dh,0ah,
               "2. Cube",0dh,0ah,
               "3. Percentage",0dh,0ah,
               "4. nCr",0dh,0ah,
               "5. Trigonometric Functions",0dh,0ah,
               "6. Exit",0dh,0ah,
               "Enter your choice: ",0


factPrompt BYTE "Enter a number: ",0
factMsg    BYTE "Factorial = ",0

cubePrompt BYTE "Enter a number: ",0
cubeMsg    BYTE "Cube = ",0

perPrompt1 BYTE "Enter first number: ",0
perPrompt2 BYTE "Enter second number: ",0
perMsg     BYTE "Percentage = ",0

nPrompt1   BYTE "Enter n: ",0
nPrompt2   BYTE "Enter r: ",0
nCrMsg     BYTE "nCr = ",0

; Trigonometric menu
triMenu    BYTE "----- Trigonometric Menu -----",0dh,0ah,
                  "1. sin(x)",0dh,0ah,
                  "2. cos(x)",0dh,0ah,
                  "3. tan(x)",0dh,0ah,
                  "4. Back to Main Menu",0dh,0ah,
                  "Enter choice: ",0

angleMsg   BYTE "Enter angle in degrees: ",0
resultMsg  BYTE "Result = ",0

degToRad REAL8 0.017453292519943295
mul_10000 REAL8 10000.0

.data?
tempInt DWORD ?
n DWORD ?
r DWORD ?
nMINUSr DWORD ?
nfact DWORD ?
rfact DWORD ?
nMINUSrFact DWORD ?


.code
main PROC

main_loop:
    mov edx, OFFSET mainMenu
    call WriteString
    call ReadInt

    cmp eax, 1
    je doFactorial
    cmp eax, 2
    je doCube
    cmp eax, 3
    je doPercentage
    cmp eax, 4
    je doNcr
    cmp eax, 5
    je doTrig
    cmp eax, 6
    je exitProgram

    jmp main_loop     ; invalid input


;--------- OPTION 1: FACTORIAL -----------
doFactorial:
    mov edx, OFFSET factPrompt
    call WriteString
    call ReadInt
    push eax
    call Fact
    mov edx, OFFSET factMsg
    call WriteString
    call WriteInt
    call CrLf
    call CrLf
    jmp main_loop


;---------- OPTION 2: CUBE ---------------
doCube:
    mov edx, OFFSET cubePrompt
    call WriteString
    call ReadInt
    push eax
    call CubeProc
    jmp main_loop


;---------- OPTION 3: PERCENTAGE ---------
doPercentage:
    mov edx, OFFSET perPrompt1
    call WriteString
    call ReadInt
    mov ebx, eax

    mov edx, OFFSET perPrompt2
    call WriteString
    call ReadInt

    push ebx    ; first number
    push eax    ; second number
    call PercentProc
    jmp main_loop


;---------- OPTION 4: NCR ----------------
doNcr:
    mov edx, OFFSET nPrompt1
    call WriteString
    call ReadInt
    mov n, eax

    mov edx, OFFSET nPrompt2
    call WriteString
    call ReadInt
    mov r, eax

    mov ecx, n
    sub ecx, r
    mov nMINUSr, ecx

    push n
    push r
    call nCrFunc
    jmp main_loop


;--------- OPTION 5: TRIG FUNCTIONS ------
doTrig:
    call TrigonometricCalculation
    jmp main_loop


exitProgram:
    exit
main ENDP


;                 FACTORIAL FUNCTION

Fact PROC
    push ebp
    mov  ebp, esp
    mov eax, [ebp+8]

    cmp eax, 1
    jbe FBase

    dec eax
    push eax
    call Fact

    mov ebx, [ebp+8]
    mul ebx
    jmp FDone

FBase:
    mov eax, 1

FDone:
    pop ebp
    ret 4
Fact ENDP


;                 CUBE PROCEDURE
CubeProc PROC
    push ebp
    mov ebp, esp

    mov eax, [ebp+8]
    mov ebx, eax
    mul ebx
    mul ebx

    mov edx, OFFSET cubeMsg
    call WriteString
    call WriteInt
    call CrLf
    call CrLf

    pop ebp
    ret 4
CubeProc ENDP


;                PERCENTAGE PROCEDURE

PercentProc PROC
    push ebp
    mov ebp, esp

    mov eax, [ebp+12]   ; first number 
    mov ebx, [ebp+8]    ; second number
    mov ecx, 100
    xor edx, edx

    mul ebx
    div ecx

    mov edx, OFFSET perMsg
    call WriteString
    call WriteInt
    call CrLf
    call CrLf

    pop ebp
    ret 8
PercentProc ENDP


; NCR PROCEDURE

nCrFunc PROC
    push ebp
    mov ebp, esp

    ; Calculate n!
    mov eax, [ebp+12]   ; n
    push eax
    call Fact
    mov nfact, eax

    ; Calculate r!
    mov eax, [ebp+8]    ; r
    push eax
    call Fact
    mov rfact, eax

    ; Calculate (n-r)!
    mov eax, nMINUSr
    push eax
    call Fact
    mov nMINUSrFact, eax

    ; Calculate nCr = n! / (r! * (n-r)!)
    mov eax, rfact
    mul nMINUSrFact
    mov ecx, eax

    mov eax, nfact
    xor edx, edx
    div ecx

    mov edx, OFFSET nCrMsg
    call WriteString
    call WriteInt
    call CrLf
    call CrLf

    pop ebp
    ret 8
nCrFunc ENDP


;          TRIGONOMETRIC SUB-MENU FUNCTION

TrigonometricCalculation PROC

tri_loop:
    mov edx, OFFSET triMenu
    call WriteString
    call ReadInt
    mov ebx, eax

    cmp ebx, 1
    je do_sin
    cmp ebx, 2
    je do_cos
    cmp ebx, 3
    je do_tan
    cmp ebx, 4
    je tri_done
    jmp tri_loop

do_sin:
    call ReadAngleToST0
    fsin
    call PrintFixedFloat
    jmp tri_loop

do_cos:
    call ReadAngleToST0
    fcos
    call PrintFixedFloat
    jmp tri_loop

do_tan:
    call ReadAngleToST0
    fptan
    fstp st(0)
    call PrintFixedFloat
    jmp tri_loop

tri_done:
    ret
TrigonometricCalculation ENDP


; Convert Angle to Radians in ST(0)

ReadAngleToST0 PROC
    mov edx, OFFSET angleMsg
    call WriteString
    call ReadFloat

    fld degToRad
    fmulp st(1), st(0)
    ret
ReadAngleToST0 ENDP

; Print floating ST(0) with 4 decimal places

PrintFixedFloat PROC
    mov edx, OFFSET resultMsg
    call WriteString

    fld mul_10000
    fmulp st(1), st(0)

    fistp tempInt

    mov eax, tempInt
    mov ebx, 10000
    xor edx, edx
    div ebx

    call WriteDec
    mov al, '.'
    call WriteChar

    mov eax, edx
    mov ecx, 4

print_frac:
    mov ebx, 10
    xor edx, edx
    div ebx
    push dx
    loop print_frac

    mov ecx, 4
print_digits:
    pop dx
    add dl, '0'
    mov al, dl
    call WriteChar
    loop print_digits

    call CrLf
    call CrLf
    ret
PrintFixedFloat ENDP


END main
